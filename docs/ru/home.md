# 1. Введение

Регистрация не требуется, простая настройка!  
IB_extension — это чат-ассистент на базе ИИ, который можно использовать на веб-сайтах. Просто установив API-ключ вашего предпочитаемого поставщика ИИ — будь то OpenAI, Anthropic, Google или другой — вы можете начать использовать его сразу.  
Кроме того, он может подключаться к вашей собственной, самостоятельно размещённой среде, совместимой с OpenAI.

- Начиная с февраля 2025 года, Gemini от Google частично бесплатен, поэтому, воспользовавшись этой возможностью, вы сможете бесплатно использовать генеративный ИИ.
- Следующая статья кратко описывает, как настроить учётную запись ( https://j-aic.com/techblog/-PSfeaXS ).

## 1.1 Ключевые особенности

- Поддержка нескольких поставщиков ИИ
- Возможность вести диалоги с учётом содержимого веб-страницы
- Функция сохранения истории чата
- С помощью функции руководства можно выполнять конкретные действия на назначенных сайтах

## 1.2 Обработка информации

- API-ключи и история чата хранятся только локально на вашем устройстве.
- Для подробностей о том, как обрабатываются данные, передаваемые через функцию чата, ознакомьтесь с условиями использования каждого поставщика моделей.
- Наша компания не собирает данные об использовании или другую информацию исключительно через эту функцию.

---

# 2. Начальная настройка

## 2.1 Шаги по настройке поставщика API

1. **Откройте экран настроек API**  
   - Откройте виджет чата в правом нижнем углу экрана  
   - Нажмите на значок «Главная» в нижнем меню  
   - Нажмите на «Настройки API» в левом меню
2. **Выберите поставщика и введите API-ключ**  
   - Найдите карточку нужного поставщика ИИ  
   - Нажмите на значок шестерёнки для перехода в режим настройки  
   - Введите ваш API-ключ  
   - Нажмите «Сохранить»
3. **Выберите модель**  
   - Нажмите «Выбрать модель» на карточке поставщика  
   - Выберите модель из списка доступных
4. **Включите поставщика**  
   - После настройки включите переключатель  
   - Статус обновится, как только настройки будут корректно применены

## 2.2 Поддерживаемые поставщики

### OpenAI

- Формат ключа: строка, начинающаяся с `sk-`
- Основные модели: GPT-4, GPT-3.5-turbo
- Получение API-ключа: доступно на сайте OpenAI

### Anthropic

- Формат ключа: строка, начинающаяся с `sk-ant-api`
- Основные модели: Claude-3-Opus, Claude-3-Sonnet
- Получение API-ключа: доступно на сайте Anthropic

### Google Gemini

- Формат ключа: строка, начинающаяся с `AIza`
- Основная модель: gemini-pro
- Получение API-ключа: доступно через Google Cloud Console

### Deepseek

- Формат ключа: строка, начинающаяся с `sk-ds-api`
- Основные модели: Deepseek-LLM, Deepseek-XL
- Получение API-ключа: доступно на сайте Deepseek

### Совместимый с OpenAI

- Формат ключа: любая строка (согласно спецификациям поставщика)
- Основные модели: модели, совместимые с OpenAI, предоставляемые поставщиком
- Получение API-ключа: доступно на сайте каждого поставщика
- Особенности:
  - Требует настройки пользовательского конечного URL
  - Требует ручного ввода названия модели
  - Может использоваться с любым сервисом, предлагающим API, совместимый с OpenAI

### Локальный API

- Это собственный API InsightBuddy.
- Доступен для использования по отдельному соглашению.
- Предоставляет такие функции, как чтение форм и интерфейс ввода данных в форму.

---

# 3. Основное использование

## 3.1 Начало чата

1. Нажмите на синюю вкладку с правой стороны вашего браузера.
2. Откроется виджет чата.
3. Введите ваше сообщение в нижнее поле ввода.
4. Нажмите кнопку «Отправить» или клавишу Enter для отправки сообщения.

## 3.2 Использование функции чата

- **Начать новый чат**  
  - Нажмите на значок «+» в правом верхнем углу.
- **Просмотр истории чата**  
  - Нажмите на значок часов в нижнем меню.  
  - Выберите предыдущий разговор для просмотра.
- **Использование содержимого сайта**  
  - Если активирована опция «Получить содержимое текущей страницы», ассистент будет учитывать содержимое страницы при формировании ответа.

---

# 4. Устранение неполадок

## 4.1 Распространённые ошибки и их решения

### Ошибка API-ключа

- **Симптом**: Появляется сообщение об ошибке «API-ключ недействителен.»
- **Решение**:
  1. Проверьте, соответствует ли формат API-ключа требованиям.
  2. Проверьте срок действия API-ключа.
  3. При необходимости получите новый API-ключ.

### Ошибка соединения

- **Симптом**: Невозможно отправить сообщение.
- **Решение**:
  1. Проверьте ваше интернет-соединение.
  2. Перезагрузите браузер.
  3. Проверьте статус поставщика API.

### Ошибка выбора модели

- **Симптом**: Невозможно выбрать модель.
- **Решение**:
  1. Проверьте права доступа вашего API-ключа.
  2. Проверьте ограничения использования у поставщика.
  3. Попробуйте выбрать другую модель.

### Ошибка соединения с сервисом, совместимым с OpenAI

- **Симптом**: Невозможно установить соединение или получить ответ.
- **Решение**:
  1. Проверьте правильность конечного URL.
  2. Убедитесь, что введённое название модели соответствует требованиям поставщика.
  3. Проверьте, соответствует ли формат API-ключа требованиям поставщика.
  4. Проверьте статус сервиса поставщика.

## 4.2 Сброс настроек

1. Откройте экран настроек API.
2. Отключите настройки для каждого поставщика.
3. Повторно введите API-ключи.
4. Повторно выберите модели.

---

# 5. Безопасность и конфиденциальность

## 5.1 Обработка данных

- API-ключи хранятся зашифрованными локально на вашем устройстве.
- История чата хранится только локально.
- Информация о сайте используется только в объёме, необходимом для работы.

## 5.2 Рекомендуемые меры безопасности

- Регулярно обновляйте API-ключи.
- Отключайте поставщиков, которые не используются.
- Проверьте настройки конфиденциальности вашего браузера.

## 5.3 Проверка обновлений

- Убедитесь, что включено автоматическое обновление расширения Chrome.
- Регулярно проверяйте и обновляйте настройки.

---

# 6. Технические характеристики

## 6.1 Система многоходового диалога

### Базовый дизайн

- **Максимальное количество сохраняемых ходов:** 4 хода  
  - Ограничено для оптимизации использования токенов.
  - Один ход = сообщение пользователя + ответ ИИ.
  - Начиная с 5-го хода, самые старые удаляются.

### Реализованное управление диалогом

- **История диалога хранится в формате Markdown**
  - **Недавний диалог:** История предыдущих разговоров
  - **Текущее сообщение пользователя:** Текущий ввод
  - **Контекст страницы:** Информация о текущей веб-странице (необязательно)
  - **Настройки Markdown:**

    ```markdown
    # Недавний диалог
    ## Ход 1
    ### Пользователь
    Содержимое сообщения пользователя
    ### Ассистент
    Содержимое ответа ИИ
    # Текущее сообщение пользователя
    Текущий ввод пользователя
    # Контекст страницы (необязательно)
    Содержимое веб-страницы
    ```

- **К каждому запросу добавляется системное сообщение**
  - Ответы предоставляются на языке пользователя.
  - Наложены ограничения на использование украшений и Markdown.
  - Это обеспечивает согласованность диалога.
  - **Настройка системного сообщения:**

    ```text
    Вы являетесь высокопроизводительным ИИ-ассистентом. Пожалуйста, отвечайте согласно следующим инструкциям:

    # Базовое поведение
    - Сообщение, отправленное пользователем, сохраняется в ("Текущее сообщение пользователя").
    - Отвечайте на том же языке, который использует пользователь в ("Текущее сообщение пользователя").
    - Держите ответы краткими и точными.
    - Не используйте украшения и Markdown.

    # Обработка истории диалога
    - Поймите контекст, обратившись к истории диалога, отформатированной в Markdown ("Недавний диалог").
    - Каждый ход обозначается как "Ход X" и содержит диалог между пользователем и ассистентом.
    - Старайтесь, чтобы ответы соответствовали предыдущему диалогу.

    # Обработка веб-информации
    - Если существует раздел "Контекст страницы", учитывайте содержимое этой страницы при ответе.
    - Используйте информацию со страницы как дополнение, ссылаясь только на те части, которые непосредственно относятся к вопросу пользователя.
    ```

---

## 6.2 Система обработки контекста

### Получение информации со страницы

- **Реализация для оптимизации использования токенов**
  - Содержимое веб-страницы запрашивается заново для каждого запроса (не сохраняется в истории).
  - Использование токенов уменьшается за счёт оптимизации HTML.
  - Удаляются ненужные элементы (такие как `<script>`, `<style>`, `<iframe>` и т.д.).
- **Функция переключения контекста страницы**
  - Позволяет пользователю включать или отключать эту функцию.
  - Автоматически включается при использовании локального API.

### Функциональность чтения форм

- Автоматически распознаёт элементы формы.
- **Интеграция с функцией анализа PDF**
  - Автоматическое обнаружение PDF-файлов.
  - Процесс извлечения текста.
  - Интеграция с исходным контекстом формы.

---

## 6.3 Система управления поставщиками

### Специфичные реализации для поставщиков

- **OpenAI / Deepseek**
  - Использует аутентификацию Bearer.
  - Поддерживает автоматическое получение моделей.
- **Anthropic**
  - Использует аутентификацию x-api-key.
  - Требуется указать версию (например, 2023-06-01).
- **Google Gemini**
  - Аутентифицируется с помощью API-ключа.
  - Поддерживает уникальный формат ответа.
- **Совместимый с OpenAI**
  - Поддерживает настройку пользовательского конечного URL.
  - Требует ручного ввода названия модели.
  - Позволяет настраивать методы аутентификации.
- **Локальный API**
  - Поддерживает настройку пользовательских конечных точек.
  - Использует собственную систему аутентификации.

### Функциональность переключения поставщиков

- Включён только один поставщик одновременно.
- Проводится проверка целостности конфигурации:
  - Проверяется формат API-ключа.
  - Проверяется наличие необходимых элементов настройки.
  - Проверяется, выбрана ли модель.

---

## 6.4 Система управления историей

### Реализованная функция сохранения

- Хранит до 30 историй разговоров.
- **Сохранённые данные включают:**
  - Информацию о поставщике
  - Выбранную модель
  - Метку времени
  - Историю сообщений
- **Интеграция с Chrome Storage API:**
  - Позволяет обмен данными между расширениями.
  - Использует локальное хранилище в качестве резервного варианта.

### Функции истории

- **Функция редактирования разговоров**
  - Позволяет редактировать сообщения.
  - Перегенерирует ответы после редактирования.
  - Автоматически обновляет последующие сообщения.
- Фильтрация истории.
- **Проверка совместимости поставщика**
  - Проверяет, соответствует ли выбранная модель поставщику.
  - При необходимости отображает предупреждения о несовместимости.

---

## 6.5 Реализация виджета чата

### Функции UI/UX

- **Реализовано с использованием iframes**
  - Изолировано от родительской страницы.
  - Общается посредством передачи сообщений.
- **Адаптивный дизайн**
  - Подстраивается под размер экрана.
  - Автоматически изменяет размер области ввода.

### Специальные функции

- **Отображение информации о сайте**
  - Отображает HTML-содержимое.
  - Отображает содержимое форм.
- **Управление сообщениями**
  - Создание нового чата.
  - Редактирование и повторная отправка чатов (примечание: повторное использование информации сайта не допускается).
  - Переключение отображения истории чата.

---

## 6.6 Меры безопасности

### Управление API

- **Безопасное хранение API-ключей**
  - Использует Chrome Storage API.
  - Маскирует ключи при отображении.

### Защита данных

- **Ограничение контекста страницы**
  - Получает только необходимую информацию.
  - Исключает конфиденциальные данные.
- **Локальное управление данными**
  - Управляет данными сеанса.

---

## 6.7 Отладочный журнал

- Выводится следующий отладочный журнал:

  ```javascript
  console.group('Отладочная информация о передаче внешнего API');
  console.log('Отправленное сообщение:', message);
  console.log('Конфигурация API:', {
      provider: apiConfig.provider,
      model: apiConfig.model,
      customSettings: apiConfig.customSettings
  });
  console.log('Ответ API:', result);
  console.groupEnd();