# 1. Танилцуулга

Бүртгэл шаардлагагүй, хялбар тохиргоо!  
InsightBuddy Extension бол вэбсайт дээр ашиглах боломжтой AI чатлах туслах програм юм. Та OpenAI, Anthropic, Google эсвэл өөр аль ч AI үйлчилгээ үзүүлэгчийн API түлхүүрийг тохируулснаар шууд ашиглаж эхлэх боломжтой.  
Мөн өөрийн удирдлагатай OpenAI‑той нийцтэй орчинд холбох боломжтой.

- 2025 оны 2‑р сарын байдлаар Google‑ийн Gemini‑г хэсэгчлэн үнэгүй ашиглах боломжтой тул танд generative AI‑г үнэ төлбөргүй ашиглах боломж гарна.
- Дараах нийтлэлд бүртгэл үүсгэх, тохируулах талаар нэгтгэн дүгнэсэн болно ( https://j-aic.com/techblog/google-ai-studio-api-free ).

## 1.1 Гол онцлогууд

- Олон AI үйлчилгээ үзүүлэгчийг дэмждэг
- Вэбсайтын агуулгыг харгалзан үзэж яриа өрнүүлнэ
- Ярианы түүх хадгалах боломжтой
- Журам (guide) функцийг ашигласнаар тодорхой сайтуудад тусгай үйлдэл гүйцэтгэнэ

## 1.2 Мэдээлэл боловсруулах

- API түлхүүр ба ярианы түүх нь зөвхөн таны төхөөрөмж дотор локал байдлаар хадгалагдана.
- Чатаар илгээсэн өгөгдлийг хэрхэн боловсруулах талаар тус бүрийн загвар нийлүүлэгчийн үйлчилгээний нөхцөлийг үзнэ үү.
- Манай компани энэ функцоор дамжуулан ашиглалтын өгөгдөл эсвэл бусад мэдээлэл цуглуулдаггүй.

---

# 2. Эхний тохиргоо

## 2.1 API үйлчилгээ үзүүлэгчийг тохируулах алхмууд

1. **API тохиргооны цонхыг нээх**  
   - Дэлгэцийн баруун доод буланд байрлах чат widget‑ийг нээнэ  
   - Доод цэснээс "Home" дүрс дээр дарна  
   - Зүүн талын цэснээс "API Settings"‑ийг сонгоно
2. **Үзүүлэгч сонгоод API түлхүүрээ оруулах**  
   - Хүссэн AI үйлчилгээ үзүүлэгчийн картыг олно  
   - Тоног төхөөрөмж (gear) дүрс дээр дарж тохиргооны горимд орно  
   - API түлхүүрээ оруулна  
   - "Save" дээр дарна
3. **Загвар (model) сонгох**  
   - Үзүүлэгчийн картан дээрх "Select Model" дээр дарна  
   - Нээлттэй жагсаалтаас загвар сонгоно
4. **Үзүүлэгчийг идэвхжүүлэх**  
   - Тохиргоо хийсний дараа toggle унтраалгыг асаана  
   - Зөв тохируулагдсан тохиолдолд төлөвийн дэлгэц өөрчлөгдөнө

## 2.2 Дэмждэг үзүүлэгчид

### OpenAI

- Түлхүүрийн хэлбэр: `sk-`‑ээр эхэлсэн тэмдэгт мөр
- Гол загварууд: GPT‑4, GPT‑3.5‑turbo
- API түлхүүр авах: OpenAI‑ийн вэбсайтаар

### Anthropic

- Түлхүүрийн хэлбэр: `sk-ant-api`‑гаар эхэлсэн тэмдэгт мөр
- Гол загварууд: Claude‑3‑Opus, Claude‑3‑Sonnet
- API түлхүүр авах: Anthropic‑ийн вэбсайтаар

### Google Gemini

- Түлхүүрийн хэлбэр: `AIza`‑гаар эхэлсэн тэмдэгт мөр
- Гол загвар: gemini-pro
- API түлхүүр авах: Google Cloud Console‑оор

### Deepseek

- Түлхүүрийн хэлбэр: `sk-ds-api`‑гаар эхэлсэн тэмдэгт мөр
- Гол загварууд: Deepseek‑LLM, Deepseek‑XL
- API түлхүүр авах: Deepseek‑ийн вэбсайтаар

### OpenAI Compatible

- Түлхүүрийн хэлбэр: үйлчилгээ үзүүлэгчийн зааврын дагуу ямар ч тэмдэгт мөр байж болно
- Гол загварууд: Үйлчилгээ үзүүлэгчийн санал болгож буй OpenAI‑той нийцтэй загварууд
- API түлхүүр авах: Тухайн үйлчилгээ үзүүлэгчийн вэбсайтаар
- Тусгай тэмдэглэл:
  - Тохируулсан endpoint URL‑ийг заавал тохируулах
  - Загварын нэрийг гараар оруулах
  - OpenAI‑той нийцтэй API санал болгодог аливаа үйлчилгээнд ашиглаж болно

### Local API

- Энэ нь InsightBuddy‑ийн өөрийн API юм.
- Тусдаа гэрээ хийснээр ашиглах боломжтой.
- Форм уншиж боловсруулах, форм бөглөх зэрэг нэмэлт боломжуудтай.

---

# 3. Үндсэн ашиглалт

## 3.1 Чат эхлүүлэх

1. Хөтчийн баруун захад байрлах хөх таб дээр дарна.
2. Чат widget нээгдэнэ.
3. Доод талын оролтын талбарт мессежээ бичнэ.
4. Илгээх товч дарах эсвэл Enter дарж илгээнэ.

## 3.2 Чат ашиглах боломжууд

- **Шинэ чат эхлүүлэх**  
  - Дээд баруун талын "+" дүрс дээр дарна.
- **Чатын түүх үзэх**  
  - Доод цэснээс цагны дүрс дээр дарна.  
  - Өнгөрсөн ярианаас сонгон дэлгээнэ.
- **Вэбсайтын агуулга ашиглах**  
  - "Одоогийн вэбсайтын агуулгыг авах" сонголтыг идэвхжүүлснээр туслах нь одоогийн хуудсын агуулгыг харгалзан хариулт гаргана.

---

# 4. Саатал арилгах гарын авлага

## 4.1 Нийтлэг алдаанууд ба шийдлүүд

### API түлхүүрийн алдаа

- **Шинж тэмдэг**: "API түлхүүр хүчингүй" гэсэн алдаа гарна.
- **Шийдэл**:
  1. API түлхүүрийн хэлбэр зөв эсэхийг баталгаажуулна.
  2. Түлхүүрийн хүчинтэй хугацааг шалгана.
  3. Шаардлагатай бол шинэ түлхүүр авна.

### Холболтын алдаа

- **Шинж тэмдэг**: Мессеж илгээх боломжгүй.
- **Шийдэл**:
  1. Интернет холбоогоо шалгана.
  2. Хөтөчөө дахин ачаална.
  3. API үйлчилгээ үзүүлэгчийн төлөвийг шалгана.

### Загвар сонголтын алдаа

- **Шинж тэмдэг**: Загвар сонгох боломжгүй.
- **Шийдэл**:
  1. API түлхүүрийн эрх шалгах.
  2. Үйлчилгээ үзүүлэгчийн хэрэглээний хязгаарлалтыг шалгах.
  3. Өөр загвар сонгож үзэх.

### OpenAI‑той нийцтэй холболтын алдаа

- **Шинж тэмдэг**: Холбогдох эсвэл хариу авах боломжгүй.
- **Шийдэл**:
  1. Endpoint URL зөв эсэхийг шалгана.
  2. Загварын нэр үйлчилгээ үзүүлэгчийн заавартай таарч буй эсэхийг баталгаажуулна.
  3. API түлхүүрийн хэлбэр шаардлагад нийцэж байгаа эсэхийг шалгана.
  4. Үйлчилгээ үзүүлэгчийн ажиллагааны төлөвийг шалгана.

## 4.2 Тохиргоог дахин тохируулах

1. API тохиргооны цонхыг нээнэ.
2. Үзүүлэгч бүрийн тохиргоог унтраана.
3. API түлхүүрүүдийг дахин оруулна.
4. Загваруудыг дахин сонгоно.

---

# 5. Аюулгүй байдал ба нууцлал

## 5.1 Өгөгдөл боловсруулах

- API түлхүүрүүд таны төхөөрөмж дээр шифрлэгдэн хадгалагдана.
- Чатын түүх зөвхөн локал байдлаар хадгалагдана.
- Вэбсайтын мэдээллийг зөвхөн шаардлагатай хэмжээнд ашиглана.

## 5.2 Зөвлөмж болгож буй хамгаалалтын арга хэмжээ

- API түлхүүрүүдийг тогтмол шинэчил.
- Ашиглаагүй үзүүлэгчдийг унтраа.
- Хөтчийн нууцлалын тохиргоогоо шалга.

## 5.3 Шинэчлэл шалгах

- Chrome өргөтгөлийг автоматаар шинэчлэгдэхийг идэвхжүүл.
- Тохиргоогоо тогтмол шалгаж, шинэчлэ.

---

# 6. Техникийн үзүүлэлтүүд

## 6.1 Олон эргэлтийн ярианы систем

### Үндсэн дизайн

- **Хадгалах эргэлтийн дээд тоо:** 4 эргэлт
  - Токены хэрэглээг оновчтой болгох зорилготой.
  - Нэг эргэлт = хэрэглэгчийн мессеж + AI‑ийн хариу.
  - 5 дахь эргэлтээс эхлэн хамгийн хуучныг устгана.

### Хэрэгжүүлсэн ярианы удирдлага

- **Ярианы түүхийг Markdown форматаар удирдах**
  - **Сүүлийн яриа:** Өмнөх ярианы түүх
  - **Одоогийн хэрэглэгчийн мессеж:** Одоогийн оролт
  - **Хуудасны контекст:** Одоогийн вэб хуудасны мэдээлэл (заавал биш)
  - **Markdown бүтэц:**

    ```markdown
    # Recent dialogue
    ## Turn 1
    ### User
    Хэрэглэгчийн мессеж
    ### Assistant
    AI‑ийн хариу
    # Current user message
    Одоогийн хэрэглэгчийн мессеж
    # Page Context (optional)
    Хуудасны агуулга
    ```

- **Системийн prompt бүр хүсэлтэд нэмэгдэнэ**
  - Хариултыг хэрэглэгчийн хэл дээр өгнө.
  - Чимэглэл, Markdown хэрэглэхийг хязгаарлана.
  - Ярианы нийцлийг хангана.
  - **Системийн prompt бүтэц:**

    ```text
    Та өндөр гүйцэтгэлтэй AI туслах юм. Дараах зааврын дагуу хариулах уу:

    # Үндсэн зан төлөв
    - Хэрэглэгчийн мессеж ("Current user message")‑т хадгалагдана.
    - "Current user message"‑т ашигласан хэл дээр хариулна.
    - Хариултаа товч, үнэн зөв байлга.
    - Чимэглэл эсвэл Markdown бүү ашигла.

    # Ярианы түүхийг боловсруулах
    - "Recent dialogue" хэсэгт байгаа Markdown хэлбэртэй ярианы түүхийг ашиглан контекст ойлго.
    - Эргэлт бүр "Turn X" гэж өгөгдөнө.
    - Өмнөх яриатай нийцсэн хариу өгөхийг зорино.

    # Вэб мэдээлэл боловсруулах
    - "Page Context" хэсэг байвал тухайн вэб хуудасны агуулгыг хариултад харгалзан үз.
    - Хэрэглэгчийн асуулттай шууд холбоотой хэсгийг л ашигла.
    ```

---

## 6.2 Контекст боловсруулах систем

### Вэб хуудасны мэдээлэл татах

- **Токен оновчтой болгох хэрэгжилт**
  - Хэрэглэгч бүрийн асуултад хуудасны агуулгыг шинээр татна (түүхэнд хадгалахгүй).
  - HTML‑ийг оновчтой болгож токены хэрэглээг бууруулна.
  - Илүүц элементүүдийг арилгана (`<script>`, `<style>`, `<iframe>` гэх мэт).
- **Page Context унтраах/асаах функц**
  - Хэрэглэгчид энэ функцийг унтрааж/асаах боломжтой.
  - Local API ашиглаж байгаа үед автоматаар идэвхжинэ.

### Форм унших функц

- Форм элементийг автоматаар танина.
- **PDF уншигчтай интеграци**
  - PDF файлыг автоматаар илрүүлнэ.
  - Текстийн задлан шинжилгээ.
  - Эх хувийн форм контексттэй уялдуулна.

---

## 6.3 Үзүүлэгчийн удирдлагын систем

### Үзүүлэгч тус бүрийн хэрэгжилт

- **OpenAI / Deepseek**
  - Bearer authentication ашиглана.
  - Загварын автоматаар татаж авахыг дэмжинэ.
- **Anthropic**
  - x-api-key authentication ашиглана.
  - Хувилбарын заалт шаарддаг (жишээ нь 2023-06-01).
- **Google Gemini**
  - API түлхүүрээр баталгаажуулна.
  - Давтагдашгүй хариуны форматтай.
- **OpenAI Compatible**
  - Өөрчлөн тохируулсан endpoint дэмжинэ.
  - Загварын нэрийг гараар тохируулна.
  - Баталгаажуулалтын аргыг өөрчлөх боломжтой.
- **Local API**
  - Өөрчлөн тохируулсан endpoint дэмжинэ.
  - Өөрийн гэсэн баталгаажуулалтын систем ашиглана.

### Үзүүлэгч солих функц

- Нэг удаад зөвхөн нэг үзүүлэгчийг идэвхжүүлж ашиглана.
- Тохиргооны бүрэн бүтэн байдлыг шалгана:
  - API түлхүүрийн хэлбэр зөв эсэх
  - Шаардлагатай тохиргооны мөрүүд байгаа эсэх
  - Загвар сонгогдсон эсэх

---

## 6.4 Түүх удирдах систем

### Хадгалах функц

- 30 хүртэлх ярианы түүхийг хадгална.
- **Хадгалагдах мэдээлэл:**
  - Үзүүлэгчийн мэдээлэл
  - Сонгосон загвар
  - Цагийн тэмдэглэл
  - Мессежийн түүх
- **Chrome Storage API‑тай интеграц:**
  - Өргөтгөлүүд хооронд өгөгдөл хуваалцах боломжтой.
  - Сэрвэргүй горимд local storage‑ийг fallback болгон ашиглана.

### Түүхийн онцлогууд

- **Яриа засах функц**
  - Мессеж засах.
  - Зассаны дараа хариултыг дахин үүсгэнэ.
  - Дараагийн мессежүүдийг автоматаар шинэчилнэ.
- Түүх шүүх функц.
- **Үзүүлэгч нийцтэй байдлын шалгалт**
  - Сонгосон загвар үзүүлэгчтэй таарч буй эсэх.
  - Шаардлагатай бол нийцтэй байдлын анхааруулга харуулна.

---

## 6.5 Чат widget‑ийн хэрэгжилт

### UI/UX онцлогууд

- **iframe ашиглан хэрэгжүүлсэн**
  - Эцэг хуудаснаас тусгаарлана.
  - Messaging‑ээр дамжин харилцана.
- **Хариу дизайн**
  - Дэлгэцийн хэмжээнд зохицуулж өөрчлөгдөнө.
  - Оролтын талбарыг автоматаар өргөсгөнө.

### Тусгай онцлогууд

- **Сайтын мэдээлэл харуулах**
  - HTML агуулгыг дүрслэнэ.
  - Формын агуулгыг харуулна.
- **Мессеж удирдах**
  - Шинэ чат үүсгэх.
  - Чат засах, дахин илгээх (вэб мэдээллийг дахин ашиглах боломжгүй).
  - Чатын түүхийн харагдацыг унтраах/асаах.

---

## 6.6 Аюулгүй байдлын хэрэгжилт

### API удирдлага

- **API түлхүүрийг аюулгүй хадгалах**
  - Chrome Storage API ашиглана.
  - Түлхүүрүүдийг дэлгэцлэх үед багасган харуулна.

### Өгөгдөл хамгаалах

- **Page Context хязгаарлах**
  - Зөвхөн шаардлагатай мэдээллийг авч хэрэглэнэ.
  - Мэдрэмтгий өгөгдлийг хасна.
- **Локал өгөгдөл удирдах**
  - Сессийн өгөгдлийг удирдана.

---

## 6.7 Алдаа шалгах лог

- Дараах debug лог гардаг:

  ```javascript
  console.group('Гадаад API дамжуулалтын debug мэдээлэл');
  console.log('Илгээсэн мессеж:', message);
  console.log('API тохиргоо:', {
      provider: apiConfig.provider,
      model: apiConfig.model,
      customSettings: apiConfig.customSettings
  });
  console.log('API хариу:', result);
  console.groupEnd();
  ```
