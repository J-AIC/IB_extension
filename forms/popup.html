<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Form Control Extension</title>
  <!-- â˜… ä¾‹ã¨ã—ã¦ hidden ã‚¯ãƒ©ã‚¹ã‚’å®šç¾© -->
  <style>
    .hidden {
      display: none !important;
    }
    
    #p2pImageButton:hover {
      background: #1d4ed8 !important;
      transform: scale(1.02);
      transition: all 0.2s ease;
    }
    
    #p2pImageButton:active {
      background: #1e40af !important;
      transform: scale(0.98);
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }
  </style>
</head>

<body>
  <div class="popup-container">
    <!-- ===========================
         ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 
         =========================== -->
    <section class="section">
      <br>
      <h2 class="section-title">è¨­å®š</h2>
      <div id="promptSection" class="card">
        <div class="card-content">
          <div class="space-y-4">

            <!-- â–¼ ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ»ãƒ«ãƒ¼ãƒ«PDF -->
            <div class="form-group">
              <label class="block text-sm font-medium text-gray-700">ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ»ãƒ«ãƒ¼ãƒ«PDF</label>

              <!-- â–¼ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UI (ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠæ™‚ã«è¡¨ç¤º) -->
              <div id="manualPdfUploadSection" class="mt-1 flex items-center">
                <input
                  type="file"
                  id="manualPdf"
                  accept=".pdf"
                  class="form-input block w-full text-sm text-gray-500
                         file:mr-4 file:py-2 file:px-4
                         file:rounded-md file:border-0
                         file:text-sm file:font-medium
                         file:bg-blue-50 file:text-blue-700
                         hover:file:bg-blue-100"
                />
              </div>

              <!-- â–¼ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆã¿UI (ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¾Œã«è¡¨ç¤º) -->
              <div id="manualPdfSelectedSection" class="mt-1 hidden">
                <span id="manualPdfFileName" class="text-sm text-gray-700"></span>
                <button id="manualPdfRemoveBtn" class="remove-button ml-2 text-red-500">Ã—</button>
              </div>
            </div>

            <!-- â–¼ æ‰‹ç¶šããƒ»å‡¦ç†PDF -->
            <div class="form-group">
              <label class="block text-sm font-medium text-gray-700">æ‰‹ç¶šããƒ»å‡¦ç†PDF</label>

              <!-- â–¼ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UI (ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠæ™‚ã«è¡¨ç¤º) -->
              <div id="processPdfUploadSection" class="mt-1 flex items-center">
                <input
                  type="file"
                  id="processPdf"
                  accept=".pdf, .jpg, .jpeg, .png"
                  class="form-input block w-full text-sm text-gray-500
                         file:mr-4 file:py-2 file:px-4
                         file:rounded-md file:border-0
                         file:text-sm file:font-medium
                         file:bg-blue-50 file:text-blue-700
                         hover:file:bg-blue-100"
                />
              </div>

              <!-- â–¼ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆã¿UI (ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¾Œã«è¡¨ç¤º) -->
              <div id="processPdfSelectedSection" class="mt-1 hidden">
                <span id="processPdfFileName" class="text-sm text-gray-700"></span>
                <button id="processPdfRemoveBtn" class="remove-button ml-2 text-red-500">Ã—</button>
              </div>
            </div>

            <!-- â–¼ P2P Image Receiver -->
            <div class="form-group">
              <div class="p2p-divider" style="text-align: center; margin: 15px 0; position: relative;">
                <span style="background: white; padding: 0 10px; position: relative; color: #6b7280; font-size: 14px;">ã¾ãŸã¯</span>
                <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e5e7eb; z-index: -1;"></div>
              </div>
              <button id="p2pImageButton" style="background: #2563eb; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; z-index: 9999; position: relative;">
                ğŸ“± Shot
              </button>
              <div id="p2pImageStatus" class="hidden" style="margin-top: 10px;">
                <div style="background: #dbeafe; padding: 12px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <div style="
                      width: 32px; 
                      height: 32px; 
                      background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
                      border-radius: 50%; 
                      display: flex; 
                      align-items: center; 
                      justify-content: center;
                      color: white;
                      font-size: 16px;
                    ">ğŸ“¸</div>
                    <div style="flex: 1;">
                      <div style="font-weight: 600; color: #1e40af; font-size: 14px;">
                        P2P Shotç”»åƒ å—ä¿¡æ¸ˆã¿
                      </div>
                      <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="p2pImageFileName"></div>
                    </div>
                  </div>
                  
                  <!-- LLM Vision Processing Status -->
                  <div id="p2pVisionStatus" style="
                    background: rgba(59, 130, 246, 0.1); 
                    padding: 8px 12px; 
                    border-radius: 6px; 
                    margin-top: 8px;
                    border: 1px solid rgba(59, 130, 246, 0.2);
                  ">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: #1e40af;">
                      <div id="p2pVisionIcon">ğŸ”</div>
                      <span id="p2pVisionText">LLMç”»åƒè§£æå¾…æ©Ÿä¸­</span>
                    </div>
                  </div>
                </div>
                <button id="p2pImageRemoveBtn" style="
                  background: #ef4444; 
                  color: white; 
                  border: none; 
                  padding: 8px 12px; 
                  border-radius: 5px; 
                  cursor: pointer; 
                  font-size: 12px; 
                  margin-top: 10px;
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  transition: all 0.2s ease;
                ">
                  ğŸ—‘ï¸ P2Pç”»åƒã‚’å‰Šé™¤
                </button>
              </div>
            </div>

            <!-- â–¼ Webç”»é¢æŠ½å‡ºãƒœã‚¿ãƒ³ -->
            <div class="form-group">
              <label class="block text-sm font-medium text-gray-700">Webç”»é¢æŠ½å‡º</label>
              <div class="mt-1">
                <button id="extractButton" class="btn btn-secondary w-full flex items-center justify-center gap-2">
                  <i class="icon download"></i>
                  Webç”»é¢ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡º
                </button>
              </div>
              <!-- â–¼ æŠ½å‡ºçµæœè¡¨ç¤ºï¼ˆå¿…è¦ã«å¿œã˜ã¦å‹•çš„è¡¨ç¤ºï¼‰ -->
              <div id="webPagesContainer" class="mt-4 space-y-2"></div>
            </div>

            <!-- â–¼ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
            <div class="form-group">
              <label for="promptInput" class="block text-sm font-medium text-gray-700">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›</label>
              <div class="prompt-input-wrapper">
                <textarea
                  id="promptInput"
                  class="form-textarea mt-1 block w-full rounded-md border-gray-300"
                  placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                ></textarea>
              </div>
            </div>

            <!-- â–¼ GPTé€£æºå®Ÿè¡Œãƒœã‚¿ãƒ³ -->
            <div class="flex justify-end">
              <button id="gptButton" class="btn btn-primary flex items-center gap-2" disabled>
                <i class="icon send"></i>
                GPTé€£æºå®Ÿè¡Œ
              </button>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- ===========================
         ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º 
         =========================== -->
    <div id="statusDisplay" class="mt-4 bg-gray-100 p-4 rounded-lg hidden">
      <div class="flex items-center gap-2">
        <i id="statusIcon" class="icon"></i>
        <span id="statusText"></span>
      </div>
    </div>

    <!-- ===========================
         ãƒ•ã‚©ãƒ¼ãƒ åˆ¶å¾¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 
         =========================== -->
    <!-- 
      â˜… ã“ã“ã‚’ä¸¸ã”ã¨ãƒ©ãƒƒãƒ—ã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯éè¡¨ç¤ºã« (class="hidden") 
      ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¤œçŸ¥ã—ãŸã‚‰JSã‹ã‚‰ .hidden ã‚’å¤–ã—ã¦è¡¨ç¤ºã™ã‚‹ 
    -->
    <div id="formControlSection" class="hidden">
      <section class="section">
        <h2 class="section-title">ãƒ•ã‚©ãƒ¼ãƒ åˆ¶å¾¡</h2>

        <!-- å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚«ãƒ¼ãƒ‰ä¸€è¦§ -->
        <div id="formElementsContainer" class="space-y-4"></div>

        <!-- é¸æŠã•ã‚ŒãŸå€¤ã®è¡¨ç¤ºã¨é€ä¿¡ãƒœã‚¿ãƒ³ -->
        <div id="selectedValuesSection" class="mt-6 space-y-4">
          <div class="card">
            <div class="card-content">
              <h3 class="card-subtitle">é¸æŠã•ã‚ŒãŸå€¤</h3>
              <div id="selectedValuesContainer" class="mt-4"></div>
              <div class="flex justify-center mt-4">
                <button
                  id="applyFormButton"
                  class="btn btn-primary w-48 flex items-center justify-center gap-2"
                >
                  <i class="icon send"></i>
                  ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
                </button>
                <!-- â–¼ ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã‚¯ãƒªã‚¢ -->
                <button
                  id="clearFormDataButton"
                  class="btn btn-danger w-48 flex items-center justify-center gap-2"
                >
                  <i class="icon trash"></i>
                  ã‚¯ãƒªã‚¢
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- ===========================
       ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ 
       =========================== -->
  <template id="formElementTemplate">
    <div class="card mb-4">
      <div class="card-content">
        <!-- ã‚·ãƒ³ãƒ—ãƒ«ï¼šè­˜åˆ¥å­ã ã‘è¡¨ç¤ºã™ã‚‹ -->
        <div class="text-lg font-medium mb-4 element-identifier"></div>

        <!-- å…¥åŠ›å€™è£œã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¨æ¨è–¦ç†ç”± -->
        <div class="space-y-4">
          <div>
            <div class="text-sm font-medium mb-2">å…¥åŠ›å€™è£œ:</div>
            <select class="form-select w-full">
              <option value="">å€™è£œã‚’é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          <!-- æ¨è–¦ç†ç”±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
          <div class="suggestion-reason hidden">
            <div class="text-sm font-medium text-gray-700">æ¨è–¦ç†ç”±:</div>
            <div class="mt-1 p-3 bg-gray-50 rounded-md text-sm text-gray-600 suggestion-reason-content"></div>
          </div>
          <!-- ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ prompt ç·¨é›†æ¬„ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ hidden) -->
          <div class="prompt-wrapper hidden">
            <label class="block text-sm font-medium text-gray-700">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
            <input
              type="text"
              class="prompt-input form-input w-full mt-1 rounded-md border-gray-300"
            />
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- ã“ã“ã§ popup.js (ã¾ãŸã¯å¯¾å¿œã™ã‚‹JS) ã‚’èª­ã¿è¾¼ã¿ -->
  <script type="module" src="forms/popup.js"></script>
  <!-- P2P Integration will be loaded dynamically by panel-forms-init.js -->
  
  <!-- P2P Integration working correctly -->
</body>
</html>
